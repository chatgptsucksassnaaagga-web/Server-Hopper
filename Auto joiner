-- ==============================
-- Krypth AJ â€“ FINAL FIXED
-- ==============================

local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local Player = Players.LocalPlayer

local request =
    (syn and syn.request) or
    (http and http.request) or
    (fluxus and fluxus.request) or
    (krnl and krnl.request)

if type(request) ~= "function" then
    error("HTTP not supported")
end

-- ðŸ”¥ USE THE SAME URL AS THE BOTS
local RELAY_URL = "https://venture-round-blake-commercial.trycloudflare.com"

local AUTO_JOIN = false
local REFRESH_DELAY = 5
local FONT = Enum.Font.GothamBold

-- ==============================
-- GUI
-- ==============================

local gui = Instance.new("ScreenGui")
gui.Name = "KrypthAJ"
gui.ResetOnSpawn = false
gui.Parent = Player:WaitForChild("PlayerGui")

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 360, 0, 420)
main.Position = UDim2.new(0.38, 0, 0.15, 0)
main.BackgroundColor3 = Color3.fromRGB(25,25,25)
main.BackgroundTransparency = 0.02
Instance.new("UICorner", main).CornerRadius = UDim.new(0,6)
Instance.new("UIDragDetector", main)

local stroke = Instance.new("UIStroke", main)
stroke.Color = Color3.fromRGB(220,40,20)
stroke.Thickness = 2

local title = Instance.new("TextLabel", main)
title.Size = UDim2.new(1, -20, 0, 36)
title.Position = UDim2.new(0, 10, 0, 6)
title.BackgroundTransparency = 1
title.Text = "Krypth AJ"
title.TextColor3 = Color3.new(1,1,1)
title.TextSize = 24
title.Font = FONT

local logsTitle = Instance.new("TextLabel", main)
logsTitle.Size = UDim2.new(1, -20, 0, 24)
logsTitle.Position = UDim2.new(0, 10, 0, 44)
logsTitle.BackgroundTransparency = 1
logsTitle.Text = "LOGS"
logsTitle.TextColor3 = Color3.new(1,1,1)
logsTitle.TextSize = 18
logsTitle.Font = FONT

local logFrame = Instance.new("ScrollingFrame", main)
logFrame.Size = UDim2.new(1, -20, 1, -130)
logFrame.Position = UDim2.new(0, 10, 0, 74)
logFrame.CanvasSize = UDim2.new(0,0,0,0)
logFrame.ScrollBarImageTransparency = 1
logFrame.BackgroundColor3 = Color3.fromRGB(0,0,0)
logFrame.BackgroundTransparency = 0.4
Instance.new("UICorner", logFrame).CornerRadius = UDim.new(0,4)

local list = Instance.new("UIListLayout", logFrame)
list.Padding = UDim.new(0,8)

-- ==============================
-- LOG FUNCTIONS
-- ==============================

local function clearLogs()
    for _,v in ipairs(logFrame:GetChildren()) do
        if v:IsA("Frame") then v:Destroy() end
    end
    logFrame.CanvasSize = UDim2.new(0,0,0,0)
end

local function createLog(server)
    if not server.placeId or not server.jobId then return end

    local f = Instance.new("Frame", logFrame)
    f.Size = UDim2.new(1, -10, 0, 60)
    f.BackgroundColor3 = Color3.fromRGB(190,30,15)
    Instance.new("UICorner", f).CornerRadius = UDim.new(0,4)

    local name = Instance.new("TextLabel", f)
    name.Size = UDim2.new(0.6,0,0.45,0)
    name.Position = UDim2.new(0.03,0,0.05,0)
    name.BackgroundTransparency = 1
    name.Text = tostring(server.brainrot or "Unknown")
    name.TextColor3 = Color3.new(1,1,1)
    name.TextSize = 16
    name.Font = FONT

    local mps = Instance.new("TextLabel", f)
    mps.Size = UDim2.new(0.6,0,0.35,0)
    mps.Position = UDim2.new(0.03,0,0.55,0)
    mps.BackgroundTransparency = 1
    mps.Text = "$"..tostring(server.mps or 0).."/s"
    mps.TextColor3 = Color3.new(1,1,1)
    mps.TextSize = 14
    mps.Font = FONT

    local join = Instance.new("TextButton", f)
    join.Size = UDim2.new(0,90,0,40)
    join.Position = UDim2.new(0.7,0,0.15,0)
    join.Text = "JOIN"
    join.TextColor3 = Color3.new(1,1,1)
    join.TextSize = 18
    join.BackgroundColor3 = Color3.fromRGB(150,20,10)
    join.Font = FONT
    Instance.new("UICorner", join).CornerRadius = UDim.new(0,4)

    join.MouseButton1Click:Connect(function()
        TeleportService:TeleportToPlaceInstance(
            server.placeId,
            server.jobId,
            Player
        )
    end)
end

-- ==============================
-- FETCH (FIXED)
-- ==============================

local function fetchServers()
    local res = request({ Url = RELAY_URL, Method = "GET" })
    if not res or not res.Body then return end

    local ok, decoded = pcall(function()
        return HttpService:JSONDecode(res.Body)
    end)
    if not ok then return end

    -- ðŸ”¥ HANDLE BOTH OBJECT OR ARRAY
    local servers = {}
    if decoded.placeId then
        table.insert(servers, decoded)
    elseif type(decoded) == "table" then
        servers = decoded
    end

    clearLogs()
    for _,s in ipairs(servers) do
        createLog(s)
        task.wait()
    end
    logFrame.CanvasSize = UDim2.new(0,0,0,list.AbsoluteContentSize.Y + 10)
end

-- ==============================
-- BUTTONS
-- ==============================

local function makeButton(text, x)
    local b = Instance.new("TextButton", main)
    b.Size = UDim2.new(0,110,0,34)
    b.Position = UDim2.new(0, x, 1, -46)
    b.Text = text
    b.TextColor3 = Color3.new(1,1,1)
    b.TextSize = 16
    b.BackgroundColor3 = Color3.fromRGB(200,35,20)
    b.Font = FONT
    Instance.new("UICorner", b).CornerRadius = UDim.new(0,4)
    return b
end

local refreshBtn = makeButton("REFRESH", 10)
local autoBtn    = makeButton("AUTO JOIN", 130)
local clearBtn   = makeButton("CLEAR", 250)

refreshBtn.MouseButton1Click:Connect(fetchServers)
clearBtn.MouseButton1Click:Connect(clearLogs)

autoBtn.MouseButton1Click:Connect(function()
    AUTO_JOIN = not AUTO_JOIN
    autoBtn.Text = AUTO_JOIN and "AUTO: ON" or "AUTO JOIN"
end)

task.spawn(function()
    while true do
        task.wait(REFRESH_DELAY)
        if AUTO_JOIN then
            fetchServers()
        end
    end
end)

fetchServers()
