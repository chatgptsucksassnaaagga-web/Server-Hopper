-- =====================================
-- KRYPTH BRAINROT SCANNER + SUBMITTER
-- =====================================

repeat task.wait() until game:IsLoaded()

-- SERVICES
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

local Player = Players.LocalPlayer
local PLACE_ID = game.PlaceId
local RELAY_URL = "https://introducing-annual-sys-oops.trycloudflare.com"

-- EXECUTOR REQUEST
local request = request or http_request or syn.request
if not request then
	warn("No HTTP request function available")
	return
end

-- FORMAT MONEY
local function format(n)
	local s = tostring(math.floor(n))
	return s:reverse():gsub("(%d%d%d)", "%1,"):reverse():gsub("^,", "")
end

-- SCAN BRAINROTS (SAFE)
local function getBestBrainrot()
	local best

	for _,d in ipairs(workspace:GetDescendants()) do
		if d.Name == "AnimalOverhead" then
			local name = d:FindFirstChild("DisplayName")
			local gen = d:FindFirstChild("Generation")

			if name and gen and gen:IsA("TextLabel") then
				local mps = tonumber(gen.Text:gsub("%D",""))
				if mps then
					if not best or mps > best.MPS then
						best = {
							Name = name.Text,
							MPS = mps
						}
					end
				end
			end
		end
	end

	return best
end

-- SEND TO RELAY (SAFE)
local function submit(best)
	local ok, err = pcall(function()
		request({
			Url = RELAY_URL,
			Method = "POST",
			Headers = {
				["Content-Type"] = "application/json"
			},
			Body = HttpService:JSONEncode({
				brainrot = best.Name,
				money = "$" .. format(best.MPS) .. "/s",
				mps = best.MPS,
				placeId = PLACE_ID,
				jobId = game.JobId,
				players = #Players:GetPlayers(),
				maxPlayers = Players.MaxPlayers
			})
		})
	end)

	if not ok then
		warn("Submit failed:", err)
	end
end

-- ============================
-- MAIN LOOP (NO TELEPORT SPAM)
-- ============================
local lastMPS = 0

while task.wait(8) do
	local best = getBestBrainrot()
	if best and best.MPS > lastMPS then
		lastMPS = best.MPS
		submit(best)
	end
end
